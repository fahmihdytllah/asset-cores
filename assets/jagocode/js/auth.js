let btnSubmit=$(".btn-submit"),authType="number",jagoCaptcha=null,getParam=function(e){return(location.search.split(e+"=")[1]||"").split("&")[0]},loadCaptcha=()=>{grecaptcha.ready(function(){grecaptcha.execute("6Le3QkQqAAAAAEMi7-7X9FAu9TcdA0qH-t46IHu4").then(e=>{jagoCaptcha=e,btnSubmit.prop("disabled",!1)})})},getRedirectTo=(setTimeout(()=>{switch(getParam("error_code")){case"unauthorized":toastr.error("You do not have access to do this.","Unauthorized");break;case"invalid_token":toastr.warning("Your token is invalid or has expired.","Invalid Token");break;case"invalid_session":toastr.info("Your session has expired. Please log in again.","Invalid Session")}},1e3),getParam("redirectTo")),redirectTo=getRedirectTo||"/";function fetchData(e){var t=window.location.pathname.split("/").pop(),e=("object"==typeof grecaptcha&&loadCaptcha(),$.blockUI({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),{type:authType,code:e,mode:t});$.ajax({url:"/auth/exchange?redirectTo="+redirectTo,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){$.unblockUI(),toastr.success(e.message,"Good News!"),setTimeout(()=>{window.location.href=e?.redirectTo?e.redirectTo:redirectTo},2e3)},error:function(e){$.unblockUI();e=e.responseJSON?.message||"An unknown internal error occurred!";toastr.error(e,"Bad News!")}})}function callbackGoogle(e){authType="google",fetchData(e.credential)}$(function(){toastr.options={closeButton:!0,progressBar:!0,newestOnTop:!0};let e=document.querySelector("#formAuthentication"),t=$("#formAuthentication"),o=$("#phoneCountry"),a=$("#phoneCode");function n(e){var t=window.innerWidth||document.documentElement.clientWidth||screen.width,o=window.innerHeight||document.documentElement.clientHeight||screen.height,e=window.open("/auth/redirect?type="+e,"Login Account",`width=500,height=600,top=${(o-600)/2+window.screenY},left=${(t-500)/2+window.screenX},scrollbars=yes,resizable=yes`);e?e.focus():alert("Popup blocked. Please allow popups for this website.")}o&&$.get("https://ipwhois.app/json/",function(e){a.val(e.country_phone.replace("+","")),o.html(e.country_code+` (${e.country_phone})`)}),"object"==typeof grecaptcha&&loadCaptcha(),e&&FormValidation.formValidation(e,{fields:{name:{validators:{notEmpty:{message:"Please enter full name"},stringLength:{min:7,message:"Full name must be more than 7 characters"}}},email:{validators:{notEmpty:{message:"Please enter your email"},emailAddress:{message:"Please enter valid email address"}}},"email-username":{validators:{notEmpty:{message:"Please enter email / username"},stringLength:{min:6,message:"Username must be more than 6 characters"}}},password:{validators:{notEmpty:{message:"Please enter your password"},stringLength:{min:6,message:"Password must be more than 6 characters"}}},"confirm-password":{validators:{notEmpty:{message:"Please confirm password"},identical:{compare:function(){return e.querySelector('[name="password"]').value},message:"The password and its confirm are not the same"},stringLength:{min:6,message:"Password must be more than 6 characters"}}},terms:{validators:{notEmpty:{message:"Please agree terms & conditions"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:".mb-6"}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus},init:e=>{e.on("plugins.message.placed",function(e){e.element.parentElement.classList.contains("input-group")&&e.element.parentElement.insertAdjacentElement("afterend",e.messageElement)})}}).on("core.form.valid",function(){"object"==typeof grecaptcha&&loadCaptcha(),t.block({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({type:"POST",url:"?redirectTo="+redirectTo,data:$(t).serialize(),headers:{"X-Jago-Captcha":jagoCaptcha},success:function(e){t.unblock(),toastr.success(e.message,"Good News!"),e?.redirectTo&&setTimeout(()=>{window.location.href=e?.redirectTo?e.redirectTo:redirectTo},2e3)},error:function(e){t.unblock();e=e.responseJSON?.message||"An unknown internal error occurred!";toastr.error(e,"Bad News!")}})}),$(".login-github").click(function(){n("github"),authType="github"}),$(".login-facebook").click(function(){n("facebook"),authType="facebook"}),$(".login-x").click(function(){n("x"),authType="x"}),$(window).on("message",function(e){"https://account.jagocode.id"===e.originalEvent.origin&&(e=e.originalEvent?.data?.code)&&fetchData(e)})});