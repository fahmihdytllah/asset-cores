let socket=io("/third-party"),elUserId=$("#userId"),elPhoneCode=$("#phoneCode"),elPhoneNumber=$("#phoneNumber"),ps=null,method="number";document.addEventListener("DOMContentLoaded",function(){var e;(e=document.querySelector("#list-logs"))&&(ps=new PerfectScrollbar(e,{wheelPropagation:!1})),socket.on("connect",()=>{setTimeout(()=>{socket.emit("joinRoom",{userId:elUserId.val(),phoneCode:elPhoneCode.val(),phoneNumber:elPhoneNumber.val()})},1e3)})}),$(function(){let s=$("#alertLogged"),o=$("#alertSync"),d=$(".btn-submit"),c=$("#canvasPairingCode"),t=$("#canvasSyncProgress"),l=$("#canvasEventLog"),i=$("#countdown"),g=$("#list-logs"),h=$("#formAccess"),u=$("#pairingCode"),n=$("#syncProgress");$('#grantMethod button[data-bs-toggle="tab"]').on("shown.bs.tab",function(e){"number"===(method=$(e.target).data("method"))?l.hide():(g.empty(),l.show())}),socket.on("responseQRCode",e=>{var o=document.getElementById("canvasQRCode");e?.QRCode&&($("#preloadQRCode").hide(),o.innerHTML="",new QRCode(o,{text:e.QRCode,width:260,height:260,logo:"https://assets.jagocode.my.id/jagocode/img/brand-logo/whatsapp.svg",logoWidth:60,logoHeight:60,logoBackgroundTransparent:!0,correctLevel:QRCode.CorrectLevel.H}))}),socket.on("responsePairingCode",({statusCode:e,pairingCode:o,messsage:t})=>{if(h.unblock(),200===e){d.prop("disabled",!0);{var n=3;var a=i;var r=()=>{d.prop("disabled",!1),i.hide()};a.show();let t=60*n,s=setInterval(()=>{var e=Math.floor(t/60),o=t%60;a.text(String(e).padStart(2,"0")+":"+String(o).padStart(2,"0")),--t<0&&(clearInterval(s),"function"==typeof r)&&r()},1e3)}u.val(o),g.empty(),l.show(),d.hide(),c.show()}else 500===e&&(toastr.error(t,"Bad News!"),d.show(),c.hide(),l.hide())}),socket.on("connectedWhatsapp",({status:e})=>{e&&(s.show(),l.show(),h.hide(),toastr.success("Successfully Connected...","Good News!"))}),socket.on("responseAuthorizationCode",({code:e})=>{let o=new URLSearchParams(window.location.search).get("state");setTimeout(()=>{window.opener.postMessage({code:e},o),window.close()},1e3)}),socket.on("syncProgress",({progress:e})=>{o.show(),t.show(),e&&n.css("width",e+"%"),100===e&&o.hide()}),socket.on("eventLogs",e=>{var o,t=e.statusCode;500===t&&setTimeout(()=>{s.hide(),d.show(),l.hide(),g.empty(),h.show()},3e3),(500===t||400===t||200===t||202===t||201===t&&"qr"===method)&&({statusCode:t,message:e}=[e][0],o=$('<li class="list-group-item"><strong>'+r()+": </strong>"+e+"</li>"),$('<li class="list-group-item"><strong>'+r()+': </strong><span class="'+{200:"text-success",201:"text-info",202:"text-info",400:"text-warning",500:"text-danger"}[t]+'">'+e+"</span></li>"),g.append(o),t=g.scrollHeight,$(g).scrollTop(t),ps?.update())}),$(document).on("click","#copyCode",function(){var e=u.val();a(e)}),h.on("submit",function(e){e.preventDefault(),h.block({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),socket.emit("requestPairingCode",{userId:elUserId.val(),phoneCode:elPhoneCode.val(),phoneNumber:elPhoneNumber.val()})});let a=e=>{navigator.clipboard.writeText(e).then(()=>toastr.success("Code was copied successfully ","Good News!")).catch(()=>console.log("Gagal mengcopy!"))};function r(){var e=new Date;return String(e.getMonth()+1).padStart(2,"0")+`/${String(e.getDate()).padStart(2,"0")}/${e.getFullYear()} ${String(e.getHours()).padStart(2,"0")}:`+String(e.getMinutes()).padStart(2,"0")}});