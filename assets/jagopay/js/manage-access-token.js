$(document).ready(function(){let e=$("#formAccessToken"),t="new",s=!1,o={};function i(){$("#listTokens").html(""),$("#loadingTokens").show(),$.get("?type=json",function(e){if($("#loadingTokens").hide(),e.data?.length===0){$("#listTokens").html(`<div class="col-md-12">
          <div class="bg-lighter rounded p-3 mb-3 position-relative">
            <span class="text-muted">You don't have an access token yet.
          </div>
        </div>`);return}e.data.forEach(e=>{let t='<button class="btn dropdown-toggle dropdown-toggle-split hide-arrow cursor-pointer" data-bs-toggle="dropdown"><i class="ti ti-dots-vertical"></i></button><div class="dropdown-menu"><button class="dropdown-item token-edit" data-id="'+e._id+'" ><i class="ti ti-settings-code me-2"></i>Setting</button><div class="dropdown-divider"></div><button class="dropdown-item text-danger token-delete" data-id="'+e._id+'" ><i class="ti ti-trash me-2"></i>Delete</button></div>';$("#listTokens").append('<div class="col-md-6 col-xl-4 mb-4"><div class="card card-key"><div class="card-header header-elements"><h5 class="mb-0 me-2">'+e.name+'</h5><div class="card-header-elements"><span class="badge bg-'+(e.isActive?"success":"danger")+' rounded-pill">'+(e.isActive?"Active":"inActive")+'</span></div><div class="card-header-elements ms-auto">'+t+'</div></div><div class="card-body"><div class="d-flex align-items-center"><p class="me-2 mb-0 fw-medium" id="key-'+e._id+'">******************</p> <span class="text-muted cursor-pointer me-2 token-show" data-id="'+e._id+'" data-token="'+e.accessToken+'"><i class="ti ti-eye ti-sm"></i></span><span class="text-muted cursor-pointer token-copy" data-token="'+e.accessToken+'"><i class="ti ti-copy ti-sm"></i></span></div></div><div class="card-footer"><span class="text-muted">Created at '+e.formattedDate+"</span></div></div></div>")})})}i(),$(document).on("click",".token-new",function(){t="new",$("#modalAccessToken").modal("show")}),$(document).on("click",".token-edit",function(){var e;t="edit",e=s=$(this).data("id"),$.get("?type=detail&id="+e,function(e){t="edit",$("#name").val(e.name),$("#host").val(e.host),$("#modalAccessToken").modal("show")})}),$(document).on("click",".token-copy",function(){n($(this).data("token"))}),$(document).on("click",".token-delete",function(){s=$(this).data("id"),Swal.fire({text:"Are you sure you want to delete this token?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes",customClass:{confirmButton:"btn btn-primary waves-effect waves-light",cancelButton:"btn btn-outline-danger ms-2 waves-effect waves-light"},buttonsStyling:!1}).then(function(e){var t;e.value&&(t=s,$.blockUI({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+t,type:"DELETE",success:function(e){$.unblockUI(),i(),Swal.fire({title:"Good News!",text:e.message,icon:"success",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})},error:function(e){$.unblockUI();let t=e.responseJSON?.message;Swal.fire({title:"Upss!",text:t||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})}}))})}),$(document).on("click",".token-show",function(){let e=$(this).data("id"),t=$(this).data("token");void 0===o[e]&&(o[e]=!1),o[e]?($("#token-"+e).html("******************"),$(this).html('<i class="ti ti-eye ti-sm"></i>')):($("#token-"+e).html(t),$(this).html('<i class="ti ti-eye-off ti-sm"></i>')),o[e]=!o[e]}),e.submit(function(o){o.preventDefault(),e.block({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+s,type:"new"===t?"POST":"PUT",data:e.serialize(),success:function(t){i(),e.unblock(),e[0].reset(),$("#modalAccessToken").modal("hide"),Swal.fire({title:"Good News!",text:t.message,icon:"success",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})},error:function(t){e.unblock();let s=t.responseJSON?.message;Swal.fire({title:"Upss!",text:s||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})}})});let n=e=>{navigator.clipboard.writeText(e).then(()=>Swal.fire({title:"Good News!",text:"Successfully copied Access Token",icon:"success",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})).catch(()=>console.log("Gagal mengcopy!"))}});