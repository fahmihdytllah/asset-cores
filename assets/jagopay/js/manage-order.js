$(function(){let t=$("#formOrder"),e=$(".datatables-order"),n,r,s,o,a;isDarkStyle?(s=config.colors_dark.borderColor,o=config.colors_dark.bodyBg,a=config.colors_dark.headingColor):(s=config.colors.borderColor,o=config.colors.bodyBg,a=config.colors.headingColor);let i={pending:{title:"Pending",class:"bg-label-warning"},completed:{title:"Completed",class:"bg-label-success"},failed:{title:"Failed",class:"bg-label-danger"}};$(document).on("click",".edit-order",function(){var t;t=r=$(this).data("id"),$.get("?type=detail&id="+t,function({data:t}){$("#amount").val(t.amount),$("#status").val(t.status),$("#token").val(t.token),$("#customerName").val(t?.customerDetails?.name||t?.userId?.name),$("#customerEmail").val(t?.customerDetails?.email),$("#customerNumber").val(t?.customerDetails?.phoneNumber||t?.userId?.phoneNumber),$("#customerAddress").val(t?.customerDetails?.address),$("#modalOrder").modal("show")})}),e.length&&(n=e.DataTable({ajax:{url:"?type=json",type:"GET",beforeSend:function(){$(".card").block({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}})},complete:function(){$(".card").unblock()}},columns:[{data:"_id"},{data:"updatedAt"},{data:"accessTokenId"},{data:"amount"},{data:"customerDetails"},{data:"paymentMethodId"},{data:"status"},{data:"paymentMethodDetail"},{data:""},],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(t,e,n,r){return""}},{targets:1,render:function(t,e,n,r){var s=new Date(n.updatedAt),o=s.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});return'<span class="text-nowrap">'+s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",time:"numeric"})+" "+o+"</span>"}},{targets:2,render:function(t,e,n,r){return n.accessTokenId.name}},{targets:3,render:function(t,e,n,r){let s=n.amount.toLocaleString("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0});return s}},{targets:4,responsivePriority:1,render:function(t,e,n,r){var s=n.isUser?n.userId.name:n?.customerDetails?.name||"-",o=n.isUser?n.userId.phoneNumber:n?.customerDetails?.email||n?.customerDetails?.phoneNumber||0;if(n.isUser)var a='<img src="'+n.userId.avatar+'" alt="Avatar" class="rounded-circle">';else var i=["success","danger","warning","info","dark","primary","secondary"][Math.floor(6*Math.random())],l=s.match(/\b\w/g)||[],l=((l.shift()||"")+(l.pop()||"")).toUpperCase(),a='<span class="avatar-initial rounded-circle bg-label-'+i+'">'+l+"</span>";return'<div class="d-flex justify-content-start align-items-center order-name text-nowrap"><div class="avatar-wrapper"><div class="avatar avatar-sm me-3">'+a+'</div></div><div class="d-flex flex-column"><h6 class="m-0"><a href="#" class="text-heading">'+s+"</a></h6><small>"+o+"</small></div></div>"}},{targets:5,render:function(t,e,n,r){return n.paymentMethodId?.name||"Default"}},{targets:6,render:function(t,e,n,r){return n?.paymentMethodDetail||"-"}},{targets:-2,render:function(t,e,n,r){var s=n.status;return'<span class="badge px-2 '+i[s].class+'" text-capitalized>'+i[s].title+"</span>"}},{targets:-1,title:"Actions",searchable:!1,orderable:!1,render:function(t,e,n,r){return'<div class="d-flex justify-content-sm-start align-items-sm-center"><button class="btn btn-icon btn-text-secondary waves-effect waves-light rounded-pill dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i class="ti ti-dots-vertical"></i></button><div class="dropdown-menu dropdown-menu-end m-0"><button class="dropdown-item edit-order" data-id="'+n._id+'"><i class="ti ti-edit"></i>Edit</button><button class="dropdown-item send-webhook" data-id="'+n._id+'"><i class="ti ti-send"></i>Send Webhook</button><button class="dropdown-item delete-order text-danger" data-id="'+n._id+'"><i class="ti ti-trash"></i>Delete</button></div></div>'}},],dom:'<"card-header py-0 d-flex flex-column flex-md-row align-items-center"<f><"d-flex align-items-center justify-content-md-end gap-2 justify-content-center"l<"dt-action-buttons"B>>>t<"row mx-1"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',lengthMenu:[10,40,60,80,100],language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search Order",info:"Displaying _START_ to _END_ of _TOTAL_ entries",paginate:{next:'<i class="ti ti-chevron-right ti-sm"></i>',previous:'<i class="ti ti-chevron-left ti-sm"></i>'}},buttons:[{extend:"collection",className:"btn btn-label-secondary dropdown-toggle waves-effect waves-light",text:'<i class="ti ti-upload ti-xs me-2"></i>Export',buttons:[{extend:"print",text:'<i class="ti ti-printer me-2"></i>Print',className:"dropdown-item",exportOptions:{columns:[1,2,3,4,5,6],format:{body:function(t,e,n){if(t.length<=0)return t;var r=$.parseHTML(t),s="";return $.each(r,function(t,e){void 0!==e.classList&&e.classList.contains("order-name")?s+=e.lastChild.firstChild.textContent:void 0===e.innerText?s+=e.textContent:s+=e.innerText}),s}}},customize:function(t){$(t.document.body).css("color",a).css("border-color",s).css("background-color",o),$(t.document.body).find("table").addClass("compact").css("color","inherit").css("border-color","inherit").css("background-color","inherit")}},{extend:"csv",text:'<i class="ti ti-file me-2"></i>Csv',className:"dropdown-item",exportOptions:{columns:[1,2,3,4,5,6],format:{body:function(t,e,n){if(t.length<=0)return t;var r=$.parseHTML(t),s="";return $.each(r,function(t,e){void 0!==e.classList&&e.classList.contains("order-name")?s+=e.lastChild.firstChild.textContent:void 0===e.innerText?s+=e.textContent:s+=e.innerText}),s}}}},{extend:"excel",text:'<i class="ti ti-file-export me-2"></i>Excel',className:"dropdown-item",exportOptions:{columns:[1,2,3,4,5,6],format:{body:function(t,e,n){if(t.length<=0)return t;var r=$.parseHTML(t),s="";return $.each(r,function(t,e){void 0!==e.classList&&e.classList.contains("order-name")?s+=e.lastChild.firstChild.textContent:void 0===e.innerText?s+=e.textContent:s+=e.innerText}),s}}}},{extend:"pdf",text:'<i class="ti ti-file-text me-2"></i>Pdf',className:"dropdown-item",exportOptions:{columns:[1,2,3,4,5,6],format:{body:function(t,e,n){if(t.length<=0)return t;var r=$.parseHTML(t),s="";return $.each(r,function(t,e){void 0!==e.classList&&e.classList.contains("order-name")?s+=e.lastChild.firstChild.textContent:void 0===e.innerText?s+=e.textContent:s+=e.innerText}),s}}}},{extend:"copy",text:'<i class="ti ti-copy me-2"></i>Copy',className:"dropdown-item",exportOptions:{columns:[1,2,3,4,5,6],format:{body:function(t,e,n){if(t.length<=0)return t;var r=$.parseHTML(t),s="";return $.each(r,function(t,e){void 0!==e.classList&&e.classList.contains("order-name")?s+=e.lastChild.firstChild.textContent:void 0===e.innerText?s+=e.textContent:s+=e.innerText}),s}}}},]},],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(t){return"Details of "+t.data().customer}}),type:"column",renderer:function(t,e,n){var r=$.map(n,function(t,e){return""!==t.title?'<tr data-dt-row="'+t.rowIndex+'" data-dt-column="'+t.columnIndex+'"><td>'+t.title+":</td> <td>"+t.data+"</td></tr>":""}).join("");return!!r&&$('<table class="table"/><tbody />').append(r)}}}}),$(".dataTables_length").addClass("ms-n2"),$(".dt-action-buttons").addClass("pt-0"),$(".dataTables_filter").addClass("ms-n3 mb-0 mb-md-6")),t.submit(function(e){e.preventDefault(),t.block({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+r,type:"PUT",data:t.serialize(),success:function(e){t.unblock(),t[0].reset(),$("#modalOrder").modal("hide"),n.ajax.reload(),Swal.fire({title:"Good job!",text:e.message,icon:"success",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})},error:function(e){t.unblock();let n=e.responseJSON?.message;Swal.fire({title:"Upss!",text:n||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})}})}),$(".datatables-order tbody").on("click",".send-webhook",function(){let t=$(this).data("id");$.blockUI({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+t,type:"POST",success:function(t){$.unblockUI(),Swal.fire({title:"Good job!",text:t.message,icon:"success",customClass:{confirmButton:"btn btn-success waves-effect waves-light"}})},error:function(t){$.unblockUI();let e=t.responseJSON.message;Swal.fire({title:"Upss!",text:e||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary"}})}})}),$(".datatables-order tbody").on("click",".delete-order",function(){let t=$(this),e=t.data("id");Swal.fire({title:"Are you sure?",text:"Do you want to delete this order!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary me-3 waves-effect waves-light",cancelButton:"btn btn-label-secondary waves-effect waves-light"},buttonsStyling:!1}).then(function(r){r.value&&($.blockUI({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+e,type:"DELETE",success:function(e){$.unblockUI(),n.row(t.parents("tr")).remove().draw(),Swal.fire({title:"Good job!",text:e.message,icon:"success",customClass:{confirmButton:"btn btn-success waves-effect waves-light"}})},error:function(t){$.unblockUI();let e=t.responseJSON.message;Swal.fire({title:"Upss!",text:e||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary"}})}}))})}),setTimeout(()=>{$(".dataTables_filter .form-control").removeClass("form-control-sm"),$(".dataTables_length .form-select").removeClass("form-select-sm")},300)});