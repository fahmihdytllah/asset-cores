$(function(){let t=$(".datatables-basic"),e=$("#formPayMethod"),a="new",n=!1,o,r={"e-wallet":"E-Wallet",qris:"Qris",bank:"Bank Transfer",card:"Card",retail:"Retail (Toko)",paylater:"Pay Later"};$(document).on("click",".method-edit",function(){var t;a="edit",t=n=$(this).data("id"),$.get("?type=detail&id="+t,function(t){a="edit",$("#name").val(t.name),$("#channelId").val(t.channelId),$("#partner").val(t.partner),$("#category").val(t.category),$("#logoUrl").val(t.logoUrl),$("#isActive").prop("checked",t.isActive),$("#modalPayMethod").modal("show")})}),t.length&&(o=t.DataTable({ajax:{url:"?type=json",type:"GET",beforeSend:function(){$(".card").block({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}})},complete:function(){$(".card").unblock()}},columns:[{data:"_id"},{data:"name"},{data:"partner"},{data:"status"},{data:"channelId"},{data:"createdAt"},{data:""},],columnDefs:[{className:"control",orderable:!1,searchable:!1,responsivePriority:2,targets:0,render:function(t,e,a,n){return""}},{responsivePriority:1,targets:1,render:function(t,e,a,n){return'<div class="d-flex justify-content-start align-items-center "><img src="'+a.logoUrl+'" alt="'+a.name+'" class="rounded me-2 w-px-50"><div class="d-flex flex-column"><h6 class="text-nowrap mb-0">'+a.name+'</h6><small class="text-truncate d-none d-sm-block">'+r[a.category]+"</small></div></div>"}},{targets:2,render:function(t,e,a,n){return'<span class="badge bg-label-info rounded-pill text-capitalize">'+a.partner+"</span>"}},{targets:3,render:function(t,e,a,n){return'<span class="badge '+(a?.isActive?"bg-label-success":"bg-label-danger")+' text-capitalize" >'+(a?.isActive?"active":"non active")+"</span>"}},{targets:-2,render:function(t,e,a,n){let o=new Date(a.createdAt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric"});return o}},{targets:-1,title:"Actions",orderable:!1,searchable:!1,render:function(t,e,a,n){return'<div class="d-inline-block text-nowrap"><button class="btn btn-sm btn-icon btn-text-secondary rounded-pill waves-effect waves-light method-edit" data-id="'+a._id+'"><i class="ti ti-edit ti-md"></i></button><button class="btn btn-sm btn-icon btn-text-secondary rounded-pill waves-effect waves-light dropdown-toggle hide-arrow" data-bs-toggle="dropdown"><i class="ti ti-dots-vertical ti-md"></i></button><div class="dropdown-menu dropdown-menu-end m-0"><button class="dropdown-item text-danger btn-delete" data-id="'+a._id+'">Delete</button></div></div>'}},],dom:'<"card-header flex-column flex-md-row"<"head-label text-center"><"dt-action-buttons text-end pt-3 pt-md-0"B>><"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6 d-flex justify-content-center justify-content-md-end"f>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',displayLength:7,lengthMenu:[7,10,25,50,75,100],buttons:[{text:'<i class="ti ti-plus me-sm-1"></i> <span class="d-none d-sm-inline-block">New Method</span>',className:"btn btn-primary waves-effect waves-light",action:function(){a="new",$("#modalPayMethod").modal("show")}},],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(t){return t.data(),"Detail Payment"}}),type:"column",renderer:function(t,e,a){var n=$.map(a,function(t,e){return""!==t.title?'<tr data-dt-row="'+t.rowIndex+'" data-dt-column="'+t.columnIndex+'"><td>'+t.title+":</td> <td>"+t.data+"</td></tr>":""}).join("");return!!n&&$('<table class="table"/><tbody />').append(n)}}}}),$("div.head-label").html('<h5 class="card-title mb-0">Manage Payment Method</h5>')),e.submit(function(t){t.preventDefault(),e.block({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+n,type:"new"===a?"POST":"PUT",data:e.serialize(),success:function(t){e.unblock(),e[0].reset(),$("#modalPayMethod").modal("hide"),o.ajax.reload(),Swal.fire({title:"Good job!",text:t.message,icon:"success",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})},error:function(t){e.unblock();let a=t.responseJSON?.message;Swal.fire({title:"Upss!",text:a||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})}})}),$(".datatables-basic tbody").on("click",".btn-delete",function(){let t=$(this),e=t.data("id");Swal.fire({title:"Are you sure?",text:"Do you want to delete this payment method!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",customClass:{confirmButton:"btn btn-primary me-3 waves-effect waves-light",cancelButton:"btn btn-label-secondary waves-effect waves-light"},buttonsStyling:!1}).then(function(a){a.value&&($.blockUI({message:elementLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+e,type:"DELETE",success:function(e){$.unblockUI(),o.row(t.parents("tr")).remove().draw(),Swal.fire({title:"Good job!",text:e.message,icon:"success",customClass:{confirmButton:"btn btn-success waves-effect waves-light"}})},error:function(t){$.unblockUI();let e=t.responseJSON.message;Swal.fire({title:"Upss!",text:e||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary"}})}}))})}),setTimeout(()=>{$(".dataTables_filter .form-control").removeClass("form-control-sm"),$(".dataTables_length .form-select").removeClass("form-select-sm")},300)});