$(document).ready(function(){let e=$(".datatables-basic"),o,t=$("#formUpdateKey");$(document).on("click",".key-update",function(){$("#key").val($(this).data("key")),$("#modalUpdateKey").modal("show")}),$(document).on("click",".key-delete",function(){let a=$(this),n=a.data("id");Swal.fire({text:"Apakah anda yakin ingin menghapus key ini?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes",customClass:{confirmButton:"btn btn-primary waves-effect waves-light",cancelButton:"btn btn-outline-danger ms-2 waves-effect waves-light"},buttonsStyling:!1}).then(function(e){var t;e.value&&(t=a,e=n,$.blockUI({message:itemLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?id="+e,type:"DELETE",success:function(e){$.unblockUI(),o.row(t.parents("tr")).remove().draw(),Swal.fire({title:"Good News!",text:e.msg,icon:"success",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})},error:function(e){$.unblockUI();e=e.responseJSON.msg;Swal.fire({title:"Bad News!",text:e||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})}}))})}),t.submit(function(e){e.preventDefault(),t.block({message:itemLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}}),$.ajax({url:"?",type:"PUT",data:$(this).serialize(),success:function(e){t.unblock(),o?.ajax.reload(),$("#modalUpdateKey").modal("hide"),Swal.fire({title:"Good News!",text:e.msg,icon:"success",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})},error:function(e){t.unblock();e=e.responseJSON.msg;Swal.fire({title:"Bad News!",text:e||"There is an error!",icon:"error",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"}})}})}),e.length&&(o=e.DataTable({ajax:{url:"?type=json",type:"GET",beforeSend:function(){$(".card").block({message:itemLoader,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#fff",opacity:.8}})},complete:function(){$(".card").unblock()}},columns:[{data:""},{data:"userId"},{data:"userId"},{data:"name"},{data:"status"},{data:"plan"},{data:"expiredAt"},{data:""}],columnDefs:[{className:"control",orderable:!1,searchable:!1,responsivePriority:2,targets:0,render:function(e,t,a,n){return""}},{targets:1,responsivePriority:1,render:function(e,t,a,n){return a.userId?.name}},{targets:2,render:function(e,t,a,n){return a.userId?.phoneCode+a.userId?.phoneNumber}},{responsivePriority:3,targets:4,render:function(e,t,a,n){return`<span class="badge rounded-pill bg-label-${"Active"===a.status?"success":"danger"} me-1">${a.status.toUpperCase()}</span>`}},{targets:5,render:function(e,t,a,n){return`<span class="badge bg-label-info me-1">${a.plan.toUpperCase()}</span>`}},{targets:-2,render:function(e,t,a,n){return moment(a.expiredAt).calendar()}},{targets:-1,title:"Action",orderable:!1,searchable:!1,render:function(e,t,a,n){return`
            <div class="dropdown">
              <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                <i class="ti ti-dots-vertical"></i>
              </button>
              <div class="dropdown-menu">
                <button class="dropdown-item key-update" data-key="${a.accessKey}"><i class="ti ti-pencil me-1"></i> Edit</bu>
                <button class="dropdown-item text-danger key-delete" data-id="${a._id}"><i class="ti ti-trash me-1"></i> Delete</button>
              </div>
            </div>`}}],dom:'<"card-header flex-column flex-md-row"<"head-label text-center"><"dt-action-buttons text-end pt-3 pt-md-0"B>><"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6 d-flex justify-content-center justify-content-md-end"f>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',displayLength:7,lengthMenu:[7,10,25,50,75,100],buttons:[{text:'<i class="ti ti-key me-sm-1"></i> <span class="d-none d-sm-inline-block">Update Key</span>',className:"btn rounded-pill btn-label-primary waves-effect waves-light",action:function(){$("#modalUpdateKey").modal("show")}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(e){e.data();return"User Key Details"}}),type:"column",renderer:function(e,t,a){a=$.map(a,function(e,t){return""!==e.title?'<tr data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'"><td>'+e.title+":</td> <td>"+e.data+"</td></tr>":""}).join("");return!!a&&$('<table class="table"/><tbody />').append(a)}}}}),$("div.head-label").html('<h5 class="card-title mb-0">User list Keys</h5>')),setTimeout(()=>{$(".dataTables_filter .form-control").removeClass("form-control-sm"),$(".dataTables_length .form-select").removeClass("form-select-sm")},300)});